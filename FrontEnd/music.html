<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahaara - Music</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@latest/dist/framer-motion.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(-45deg, #5a9482, #f9e79f, #eef1f5, #f4c1ad);
            background-size: 400% 400%;
            animation: gradient-flow 15s ease infinite;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .text-shadow-sm {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }
        
        .progress-bar {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 9999px;
            cursor: pointer;
        }
        
        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #5a9482;
            border: 2px solid #F5F5DC;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-top: -5px;
        }
        
        .progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #5a9482;
            border: 2px solid #F5F5DC;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="text-[#333333] flex flex-col items-center justify-center min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion } = Motion;

        function MusicHeader() {
            const darkColor = "#333333";
            const lightColor = "#F5F5DC";
            
            return (
                <div className="fixed top-0 left-0 right-0 w-full p-4 flex justify-between items-center z-20">
                    <a href="./Recommendations.html" className="p-2 transition-colors" aria-label="Go back">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-shadow-sm" style={{color: darkColor}} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                        </svg>
                    </a>
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 bg-[#5a9482] rounded-lg flex items-center justify-center">
                            <span className="text-xl font-bold text-shadow-sm" style={{color: lightColor}}>Sa</span>
                        </div>
                        <h1 className="font-bold text-xl text-shadow-sm" style={{color: darkColor}}>Sahaara</h1>
                    </div>
                    <div></div>
                </div>
            );
        }

        function MusicPlayerPage() {
            const [isPlaying, setIsPlaying] = useState(false);
            const [musicTitle, setMusicTitle] = useState("Loading...");
            const [musicUrl, setMusicUrl] = useState(null);
            const [progress, setProgress] = useState(0);
            const audioRef = useRef(null);
            const darkColor = "#333333";

            useEffect(() => {
                const recommendations = JSON.parse(localStorage.getItem('sahaaraRecommendations'));
                const url = localStorage.getItem('currentMusicUrl');
                
                // --- FIX: Changed recommendations.music to recommendations.music_phrase ---
                setMusicTitle(recommendations?.music_phrase || "Calm Music");
                setMusicUrl(url);
            }, []);

            useEffect(() => {
                const audio = audioRef.current;
                if (!audio) return;

                const handlePlay = () => setIsPlaying(true);
                const handlePause = () => setIsPlaying(false);
                const updateProgress = () => {
                    setProgress((audio.currentTime / audio.duration) * 100 || 0);
                };
                
                audio.addEventListener('play', handlePlay);
                audio.addEventListener('pause', handlePause);
                audio.addEventListener('timeupdate', updateProgress);

                return () => {
                    audio.removeEventListener('play', handlePlay);
                    audio.removeEventListener('pause', handlePause);
                    audio.removeEventListener('timeupdate', updateProgress);
                };
            }, [musicUrl]);
            
            const handlePlayPause = () => {
                const audio = audioRef.current;
                if (!audio) return;

                if (isPlaying) {
                    audio.pause();
                } else {
                    audio.play().catch(error => console.error("Autoplay failed:", error));
                }
            };
            
            const handleSeek = (e) => {
                const audio = audioRef.current;
                if (!audio || !audio.duration) return;
                const seekTime = (e.target.value / 100) * audio.duration;
                audio.currentTime = seekTime;
            };

            const renderPlaybackState = () => {
                if (!musicUrl) {
                    return "Loading...";
                } else if (isPlaying) {
                    return "Now Playing";
                } else {
                    return "Paused";
                }
            };

            return (
                <div className="w-full min-h-screen flex flex-col items-center justify-center p-6 sm:p-8 relative z-10">
                    <MusicHeader />
                    
                    <div className="flex flex-col items-center mt-20 space-y-8 sm:space-y-12 w-full max-w-sm sm:max-w-md">
                        <div className="relative w-48 h-48 sm:w-64 sm:h-64 flex items-center justify-center">
                            <motion.div
                                className="absolute rounded-full border border-white/20"
                                animate={{ scale: isPlaying ? [1, 1.2, 1] : 1, opacity: isPlaying ? [0.7, 0] : 0 }}
                                transition={{ duration: 2, repeat: Infinity, ease: "easeInOut" }}
                                style={{ width: '100%', height: '100%' }}
                            />
                             <motion.div
                                className="absolute rounded-full border-2 border-white/20"
                                animate={{ scale: isPlaying ? [1, 1.4, 1] : 1, opacity: isPlaying ? [0.6, 0] : 0 }}
                                transition={{ duration: 2, repeat: Infinity, ease: "easeInOut", delay: 0.5 }}
                                style={{ width: '80%', height: '80%' }}
                            />
                            <div className="absolute w-32 h-32 sm:w-40 sm:h-40 rounded-full bg-white/50 shadow-lg" />
                            <div className="z-10 text-lg sm:text-xl font-bold text-center p-4 text-[#333333]">
                                {musicTitle}
                            </div>
                        </div>
                        
                        <div className="w-full max-w-xs sm:max-w-sm flex flex-col items-center space-y-4">
                            <motion.p
                                className="text-lg font-medium mb-4 text-shadow-sm"
                                style={{color: darkColor}}
                                key={isPlaying} /* Re-trigger animation on change */
                                initial={{ opacity: 0, y: 10 }}
                                animate={{ opacity: 1, y: 0 }}
                                transition={{ duration: 0.3 }}
                            >
                                {renderPlaybackState()}
                            </motion.p>
                            
                            <motion.button
                                onClick={handlePlayPause}
                                className="p-4 rounded-full bg-[#5a9482] text-white shadow-lg focus:outline-none focus:ring-4 focus:ring-white/50"
                                whileHover={{ scale: 1.1 }}
                                whileTap={{ scale: 0.9 }}
                                aria-label={isPlaying ? "Pause music" : "Play music"}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10 sm:h-12 sm:w-12" viewBox="0 0 20 20" fill="currentColor">
                                    {isPlaying ? (
                                        <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                                    ) : (
                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clipRule="evenodd" />
                                    )}
                                </svg>
                            </motion.button>
                            
                            <div className="w-full mt-6">
                                <input
                                    type="range"
                                    min="0"
                                    max="100"
                                    value={progress}
                                    onChange={handleSeek}
                                    className="progress-bar"
                                    style={{
                                        background: `linear-gradient(to right, #5a9482 ${progress}%, #d1d5db ${progress}%)`
                                    }}
                                />
                            </div>
                        </div>
                    </div>

                    {musicUrl && <audio ref={audioRef} src={musicUrl} loop />}
                    <div className="fixed bottom-8 text-sm text-center text-gray-600">
                        <p>✨ Generated for you by Saathi</p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MusicPlayerPage />, document.getElementById('root'));
    </script>
</body>
</html>