<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahaara - Quick Check-in</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/framer-motion@latest/dist/framer-motion.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
        }

        @keyframes drift {
            0% { transform: translateY(0px) translateX(0px) scale(1); }
            25% { transform: translateY(-30px) translateX(20px) scale(1.05); }
            50% { transform: translateY(0px) translateX(-20px) scale(1); }
            75% { transform: translateY(20px) translateX(30px) scale(0.95); }
            100% { transform: translateY(0px) translateX(0px) scale(1); }
        }

        @keyframes drift-reverse {
            0% { transform: translateY(0px) translateX(0px); }
            50% { transform: translateY(40px) translateX(-40px); }
            100% { transform: translateY(0px) translateX(0px); }
        }

        .animate-drift {
            animation: drift 25s infinite ease-in-out;
        }
        .animate-drift-reverse {
            animation: drift-reverse 30s infinite ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

<script type="text/babel">
    
    const { useState, useEffect } = React;
    const { motion, AnimatePresence } = Motion;

    const cardVariants = {
      initial: { opacity: 0, scale: 0.9 },
      animate: { opacity: 1, scale: 1, transition: { duration: 0.4, ease: 'easeOut' } },
      exit: { opacity: 0, scale: 0.9, transition: { duration: 0.2, ease: 'easeIn' } },
    };
    
    function AssessmentHeader({ onBack }) {
        return (
            <div className="relative flex justify-center items-center">
                {onBack && (
                    <button 
                        onClick={onBack} 
                        className="absolute left-0 p-2 rounded-full transition-colors hover:bg-gray-100"
                        aria-label="Go back"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                )}
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-[#5a9482] rounded-lg flex items-center justify-center">
                        <span className="text-white text-xl font-bold">Sa</span>
                    </div>
                    <div>
                        <h1 className="font-bold text-lg text-[#333333]">Sahaara</h1>
                        <p className="text-sm text-gray-500">Quick Check-in</p>
                    </div>
                </div>
            </div>
        );
    }

    function ProgressBar({ current, total }) {
      const percentage = ((current - 1) / total) * 100;
      return (
        <div>
          <div className="flex justify-end mb-1">
            <span className="text-sm font-bold text-[#5a9482]">{Math.round(percentage)}%</span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
            <motion.div 
              className="bg-[#5a9482] h-2 rounded-full"
              initial={{ width: '0%' }}
              animate={{ width: `${percentage}%` }}
              transition={{ duration: 0.5, ease: 'easeOut' }}
            />
          </div>
        </div>
      );
    }

    function Step1_Emotion({ onNext }) {
      const emotions = [
        { emoji: 'üòÑ', label: 'Great' },
        { emoji: 'üôÇ', label: 'Good' },
        { emoji: 'üòê', label: 'Okay' },
        { emoji: 'üòû', label: 'Bad' },
        { emoji: 'üò´', label: 'Awful' },
      ];

      return (
        <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg space-y-6">
          <AssessmentHeader />
          <ProgressBar current={1} total={5} />
          <h2 className="text-center text-2xl sm:text-3xl font-bold text-[#333333] pt-4">How are you feeling right now?</h2>
          <div className="flex justify-around items-end flex-wrap gap-2">
            {emotions.map((emotion) => (
              <button
                key={emotion.emoji}
                onClick={() => onNext({ emotion: emotion.emoji })}
                className="p-2 w-16 h-16 sm:w-20 sm:h-20 rounded-full text-3xl sm:text-4xl transform transition-transform duration-200 hover:scale-110 hover:bg-[#f9e79f]/50 flex flex-col items-center justify-center"
              >
                {emotion.emoji}
                <span className="mt-1 text-xs sm:text-sm font-medium text-gray-600">{emotion.label}</span>
              </button>
            ))}
          </div>
        </motion.div>
      );
    }

    function Step2_Energy({ onNext, onBack }) {
      const [energy, setEnergy] = useState(50);
      return (
        <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg space-y-6">
          <AssessmentHeader onBack={onBack} />
          <ProgressBar current={2} total={5} />
          <h2 className="text-center text-2xl sm:text-3xl font-bold text-[#333333] pt-4">How‚Äôs your energy right now?</h2>
          <div className="space-y-4">
            <input
              type="range"
              min="0"
              max="100"
              value={energy}
              onChange={(e) => setEnergy(e.target.value)}
              className="w-full h-3 bg-gradient-to-r from-[#5a9482] to-[#f9e79f] rounded-full appearance-none cursor-pointer"
            />
            <div className="flex justify-between text-sm font-medium text-[#333333]">
              <span>Low</span>
              <span>High</span>
            </div>
          </div>
          <button 
            onClick={() => onNext({ energy: parseInt(energy) })}
            className="w-full py-3 bg-[#5a9482] text-white font-bold rounded-full transition-opacity hover:opacity-90"
          >
            Next
          </button>
        </motion.div>
      );
    }

    function Step3_Social({ onNext, onBack }) {
      const options = ['Yes', 'Kind of', 'Not really'];
      return (
        <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg space-y-6">
          <AssessmentHeader onBack={onBack} />
          <ProgressBar current={3} total={5} />
          <h2 className="text-center text-2xl sm:text-3xl font-bold text-[#333333] pt-4">Feeling connected to people around you?</h2>
          <div className="space-y-4">
            {options.map((option) => (
              <button
                key={option}
                onClick={() => onNext({ social: option })}
                className="w-full text-left p-4 border border-gray-200 rounded-xl text-lg font-medium text-[#333333] transform transition-all hover:bg-[#5a9482] hover:text-white hover:scale-105"
              >
                {option}
              </button>
            ))}
          </div>
        </motion.div>
      );
    }

    function Step4_Context({ onNext, onBack }) {
      const [selected, setSelected] = useState([]);
      const tags = ['School', 'Exams', 'Friends', 'Family', 'Health', 'Nothing specific'];
      
      const toggleTag = (tag) => {
        setSelected(
          selected.includes(tag)
            ? selected.filter((t) => t !== tag)
            : [...selected, tag]
        );
      };

      return (
        <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg space-y-6">
          <AssessmentHeader onBack={onBack} />
          <ProgressBar current={4} total={5} />
          <h2 className="text-center text-2xl sm:text-3xl font-bold text-[#333333] pt-4">What‚Äôs on your mind the most?</h2>
          <div className="flex flex-wrap justify-center gap-3">
            {tags.map((tag) => (
              <button
                key={tag}
                onClick={() => toggleTag(tag)}
                className={`py-2 px-4 rounded-full font-medium transition-colors ${
                  selected.includes(tag)
                    ? 'bg-[#5a9482] text-white'
                    : 'bg-gray-200 text-[#333333]'
                }`}
              >
                {tag}
              </button>
            ))}
          </div>
          <button 
            onClick={() => onNext({ context: selected })}
            className="w-full py-4 bg-[#f4c1ad] text-[#333333] font-bold text-lg rounded-full transition-opacity hover:opacity-90"
          >
            Next
          </button>
        </motion.div>
      );
    }

    // --- NEW: Step for free-text thoughts ---
    function Step5_FreeText({ onNext, onBack }) {
        const [thoughts, setThoughts] = useState('');
        return (
            <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg space-y-6">
                <AssessmentHeader onBack={onBack} />
                <ProgressBar current={5} total={5} />
                <h2 className="text-center text-2xl sm:text-3xl font-bold text-[#333333] pt-4">Anything else on your mind?</h2>
                <textarea
                    value={thoughts}
                    onChange={(e) => setThoughts(e.target.value)}
                    className="w-full p-4 h-32 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5a9482] resize-none"
                    placeholder="Write your thoughts here..."
                ></textarea>
                <button 
                    onClick={() => onNext({ thoughts: thoughts })}
                    className="w-full py-4 bg-[#f4c1ad] text-[#333333] font-bold text-lg rounded-full transition-opacity hover:opacity-90"
                >
                    Discover My Path
                </button>
            </motion.div>
        );
    }

    function Step6_Crafting({ onBack }) {
      return (
        <motion.div variants={cardVariants} initial="initial" animate="animate" exit="exit" className="w-full max-w-md p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-lg text-center space-y-6">
          <AssessmentHeader onBack={onBack} />
          <div className="pt-4">
            <h2 className="text-2xl font-bold text-[#333333]">Crafting your compass...</h2>
            <div className="flex justify-center items-center py-8">
              <motion.div
                className="w-16 h-16 bg-[#5a9482]/50 rounded-full"
                animate={{
                  scale: [1, 1.2, 1],
                  opacity: [0.7, 1, 0.7],
                }}
                transition={{
                  duration: 2,
                  ease: "easeInOut",
                  repeat: Infinity,
                }}
              />
            </div>
            <p className="text-[#333333]">Personalizing your recommendations.</p>
          </div>
        </motion.div>
      );
    }
    
    function LightningAssessment() {
      const [step, setStep] = useState(1);
      const [answers, setAnswers] = useState({});

      const handleNextStep = (data) => {
        setAnswers({ ...answers, ...data });
        setStep(step + 1);
      };

      const handleBackStep = () => {
        setStep(step - 1);
      };
      
      const handleSubmit = async (data) => {
        const finalAnswers = { ...answers, ...data };
        
        // Save the original answers to local storage for the crisis return flow
        localStorage.setItem('sahaaraOriginalAnswers', JSON.stringify(finalAnswers));

        console.log("Final Assessment Answers:", finalAnswers);
        setAnswers(finalAnswers);
        setStep(step + 1); // Move to the "Crafting..." screen

        try {
            const response = await fetch("https://sahaara-mental-wellness.onrender.com/api/checkin", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                emotion: finalAnswers.emotion,
                energy: finalAnswers.energy,
                social: finalAnswers.social,
                context: finalAnswers.context,
                thoughts: finalAnswers.thoughts
              }),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            
            if (result.status === "crisis_detected") {
                // Redirect to the crisis page immediately
                window.location.href = './crisis.html';
            } else {
                // Save the complete AI response to local storage
                localStorage.setItem('sahaaraRecommendations', JSON.stringify(result));
                
                // Redirect to the recommendations page after 5 seconds
                setTimeout(() => {
                  window.location.href = './Recommendations.html';
                }, 5000); 
            }
        } catch (error) {
            console.error("Failed to submit check-in:", error);
            // On error, still redirect to a safe page
            window.location.href = './Recommendations.html';
        }
      };

      return (
        <div className="w-full min-h-screen bg-[#eef1f5] flex items-center justify-center font-sans overflow-hidden p-4 relative z-0">
          <div className="absolute top-0 -left-24 w-72 h-72 bg-[#f4c1ad] rounded-full opacity-30 blur-2xl animate-drift -z-10"></div>
          <div className="absolute bottom-0 -right-24 w-96 h-96 bg-[#5a9482] rounded-full opacity-20 blur-2xl animate-drift-reverse -z-10"></div>
          <div className="absolute bottom-20 left-20 w-48 h-48 bg-[#f9e79f] rounded-full opacity-20 blur-xl animate-drift -z-10"></div>

          <AnimatePresence mode="wait">
            {step === 1 && <Step1_Emotion key="step1" onNext={handleNextStep} />}
            {step === 2 && <Step2_Energy key="step2" onNext={handleNextStep} onBack={handleBackStep} />}
            {step === 3 && <Step3_Social key="step3" onNext={handleNextStep} onBack={handleBackStep} />}
            {step === 4 && <Step4_Context key="step4" onNext={handleNextStep} onBack={handleBackStep} />}
            {step === 5 && <Step5_FreeText key="step5" onNext={handleSubmit} onBack={handleBackStep} />}
            {step === 6 && <Step6_Crafting key="step6" />}
          </AnimatePresence>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LightningAssessment />);
    
    </script>
</body>
</html>
</body>
</html>